<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thought Chain Test - Dialogue Player</title>
  <link rel="stylesheet" href="styles/components/dialogue-player.css">
  <style>
    body {
      margin: 0;
      padding: 40px 20px;
      background: #F9F8F6;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #2d2d2d;
      margin-bottom: 40px;
    }
    .info-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .info-section h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #374151;
    }
    #dialogue-container {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ§  æ€ç»´é“¾æµ‹è¯• Thought Chain Test</h1>

    <!-- Test Info -->
    <div class="info-section">
      <h2>ğŸ“‹ æµ‹è¯•ç›®æ ‡ Test Objectives</h2>
      <ul>
        <li>âœ… é¡µé¢åŠ è½½ï¼šç¬¬1æ¡æ¶ˆæ¯å¯è§ï¼ˆcurrentï¼‰ï¼Œç¬¬2ã€3ã€4æ¡æ˜¾ç¤ºæ€ç»´é“¾ï¼ˆfutureï¼‰</li>
        <li>âœ… æ€ç»´é“¾è½®æ’­ï¼šæ¯2ç§’åˆ‡æ¢ä¸€æ¡æ€è€ƒå†…å®¹</li>
        <li>âœ… "ç”Ÿæˆä¸­..." æ ‡ç­¾æ˜¾ç¤ºåœ¨å³ä¸Šè§’</li>
        <li>âœ… æ¶ˆæ¯å†…å®¹å¯¹ future æ¶ˆæ¯éšè—ï¼ˆdisplay: noneï¼‰</li>
        <li>âœ… æ¶ˆæ¯æ˜¾ç¤ºæ—¶ï¼šåœæ­¢æ€ç»´é“¾ï¼Œç§»é™¤å…ƒç´ ï¼Œæ˜¾ç¤ºçœŸå®å†…å®¹</li>
      </ul>
    </div>

    <!-- Dialogue Player Container -->
    <div id="dialogue-container"></div>

    <!-- Debug Console -->
    <div class="info-section">
      <h2>ğŸ è°ƒè¯•ä¿¡æ¯ Debug Console</h2>
      <div id="debug-console" style="font-family: monospace; font-size: 0.875rem; max-height: 300px; overflow-y: auto; background: #f3f4f6; padding: 12px; border-radius: 4px;">
        <div style="color: #6b7280;">ç­‰å¾…åˆå§‹åŒ–...</div>
      </div>
    </div>
  </div>

  <!-- Load DialoguePlayer Component -->
  <script src="js/components/dialogue-player.js"></script>

  <script>
    // Redirect console.log to debug console
    const debugConsole = document.getElementById('debug-console');
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const logEntry = document.createElement('div');
      logEntry.textContent = args.join(' ');
      logEntry.style.color = '#374151';
      logEntry.style.marginBottom = '4px';
      debugConsole.appendChild(logEntry);
      debugConsole.scrollTop = debugConsole.scrollHeight;
    };

    // Mock VULCA_DATA for persona lookup
    window.VULCA_DATA = {
      personas: [
        { id: 'su-shi', nameZh: 'è‹è½¼', nameEn: 'Su Shi', color: '#B85C3C' },
        { id: 'john-ruskin', nameZh: 'çº¦ç¿°Â·ç½—æ–¯é‡‘', nameEn: 'John Ruskin', color: '#8B4513' }
      ]
    };

    // Test data: 4 messages from Su Shi and John Ruskin
    const testThread = {
      id: 'test-thread-1',
      artworkId: 'artwork-1',
      topic: 'æœºæ¢°ç¬”è§¦ä¸­çš„è‡ªç„¶éŸµå¾‹',
      topicEn: 'Natural Rhythm in Mechanical Brushstrokes',
      participants: ['su-shi', 'john-ruskin'],
      messages: [
        {
          id: 'msg-1',
          personaId: 'su-shi',
          textZh: 'è§‚æ­¤æœºæ¢°ä¹‹ç¬”ï¼Œè™½æ— ç”Ÿå‘½ï¼Œå´æœ‰éŸµå¾‹ã€‚ç®—æ³•é©±åŠ¨ä¹‹ä¸‹ï¼Œç«Ÿèƒ½æ˜¾ç°å‡ºè‡ªç„¶ä¹‹æ°”ã€‚è¿™è®©æˆ‘æƒ³èµ·å¤äººè®ºç”»ï¼š"ç”»è€…ï¼Œæ–‡ä¹‹æä¹Ÿã€‚"æŠ€æœ¯è™½æ–°ï¼Œå…¶æœ¬è´¨ä»åœ¨ä¼ è¾¾ç¥éŸµã€‚',
          textEn: 'Observing these mechanical brushstrokes, though lifeless, they possess rhythm. Driven by algorithms, they manifest the essence of nature. This reminds me of the ancient saying: "Painting is the ultimate expression of literature." Though the technique is new, its essence remains in conveying spirit.',
          interactionType: 'initial',
          timestamp: 0
        },
        {
          id: 'msg-2',
          personaId: 'john-ruskin',
          textZh: 'è‹å…ˆç”Ÿæ‰€è§ç”šæ˜¯ã€‚ç„¶æˆ‘å¿…é¡»æŒ‡å‡ºï¼ŒçœŸæ­£çš„è‰ºæœ¯å¿…é¡»æºäºå¯¹è‡ªç„¶çš„å¿ å®è§‚å¯Ÿå’Œé“å¾·æƒ…æ„Ÿã€‚è¿™äº›æœºæ¢°ç¬”è§¦æ˜¯å¦çœŸçš„ç†è§£äº†è‡ªç„¶çš„ç¥åœ£ç§©åºï¼Ÿè¿˜æ˜¯ä»…ä»…æ¨¡ä»¿äº†è¡¨é¢çš„å½¢å¼ï¼Ÿ',
          textEn: 'Mr. Su makes a keen observation. However, I must point out that true art must arise from faithful observation of nature and moral sentiment. Do these mechanical strokes truly understand the divine order of nature? Or do they merely imitate superficial forms?',
          interactionType: 'challenge',
          referenceTo: 'msg-1',
          timestamp: 5000
        },
        {
          id: 'msg-3',
          personaId: 'su-shi',
          textZh: 'ç½—æ–¯é‡‘å…ˆç”Ÿä¹‹é—®ç”šä¸ºç²¾å¦™ã€‚ç„¶æˆ‘ä»¥ä¸ºï¼Œå½¢å¼ä¸ç¥éŸµæœ¬ä¸å¯åˆ†ã€‚æœºæ¢°è™½ä¸èƒ½"ç†è§£"ï¼Œä½†è‹¥å…¶åˆ›é€ è€…æ€€æœ‰å¯¹è‡ªç„¶çš„æ•¬ç•ä¹‹å¿ƒï¼Œåˆ™æœºæ¢°äº¦èƒ½æˆä¸ºä¼ è¾¾æ­¤å¿ƒæ„çš„å·¥å…·ã€‚å¦‚åŒæ¯›ç¬”æœ¬æ— æƒ…æ„Ÿï¼Œå´å› ä¹¦è€…ä¹‹å¿ƒè€Œç”Ÿæ°”éŸµã€‚',
          textEn: 'Mr. Ruskin poses a most excellent question. Yet I believe form and spirit are inseparable. Though machines cannot "understand," if their creators hold reverence for nature, machines can become tools for conveying this sentiment. Just as a brush has no emotion, yet comes alive through the writer\'s heart.',
          interactionType: 'defend',
          referenceTo: 'msg-2',
          timestamp: 10000
        },
        {
          id: 'msg-4',
          personaId: 'john-ruskin',
          textZh: 'è¿™æ˜¯ä¸€ä¸ªæ·±åˆ»çš„è§‚ç‚¹ã€‚æˆ‘æ‰¿è®¤ï¼Œå·¥å…·æœ¬èº«çš„é“å¾·æ€§åœ¨äºä½¿ç”¨è€…çš„æ„å›¾ã€‚è‹¥æœºæ¢°è‰ºæœ¯çš„åˆ›ä½œè€…ç¡®å®æ€€æœ‰å¯¹è‡ªç„¶å’ŒçœŸç†çš„çœŸè¯šè¿½æ±‚ï¼Œé‚£ä¹ˆæˆ–è®¸è¿™ç§æ–°å½¢å¼ä¹Ÿå¯ä»¥è¾¾åˆ°è‰ºæœ¯çš„å´‡é«˜å¢ƒç•Œã€‚ä½†æˆ‘ä»¬å¿…é¡»è­¦æƒ•æŠ€æœ¯å¯¹äººæ€§çš„å¼‚åŒ–ã€‚',
          textEn: 'This is a profound point. I concede that the morality of a tool lies in the intent of its user. If creators of mechanical art truly possess a sincere pursuit of nature and truth, then perhaps this new form can also reach the sublime heights of art. But we must remain vigilant against technology\'s alienation of humanity.',
          interactionType: 'concede',
          referenceTo: 'msg-3',
          timestamp: 15000
        }
      ]
    };

    // Initialize DialoguePlayer
    console.log('ğŸš€ Initializing DialoguePlayer...');
    const container = document.getElementById('dialogue-container');

    try {
      const player = new DialoguePlayer(testThread, container, {
        autoPlay: true,
        speed: 1.0,
        showControls: true
      });

      console.log('âœ… DialoguePlayer initialized successfully');
      console.log(`ğŸ“Š Total messages: ${testThread.messages.length}`);
      console.log('â° Messages will appear every 5 seconds (scaled by speed)');

      // Log state every 2 seconds
      setInterval(() => {
        const messages = container.querySelectorAll('.dialogue-message');
        const futureMessages = container.querySelectorAll('.dialogue-message.future');
        const currentMessage = container.querySelector('.dialogue-message.current');

        console.log(`ğŸ“ˆ State: ${messages.length} total, ${futureMessages.length} future, current: ${currentMessage ? currentMessage.dataset.messageId : 'none'}`);

        // Log thought chain states
        futureMessages.forEach(msg => {
          const thoughtChain = msg.querySelector('.thought-chain');
          const activeThought = msg.querySelector('.thought-chain-item.active');
          if (thoughtChain && activeThought) {
            console.log(`ğŸ§  ${msg.dataset.messageId}: ${activeThought.textContent}`);
          }
        });
      }, 2000);

    } catch (error) {
      console.error('âŒ DialoguePlayer initialization failed:', error);
    }
  </script>
</body>
</html>
