<!DOCTYPE html>
<html lang="zh-CN" data-lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quote Interaction Test - Phase 5</title>
  <link rel="stylesheet" href="styles/components/dialogue-player.css">
  <style>
    body {
      margin: 0;
      padding: 40px 20px;
      background: #F9F8F6;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #2d2d2d;
      margin-bottom: 20px;
    }
    .test-info {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-info h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #374151;
    }
    #dialogue-container {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>Phase 5: Quote Interaction Test</h1>

    <div class="test-info">
      <h2>ğŸ§ª æµ‹è¯•è¯´æ˜ Test Instructions</h2>
      <p><strong>æ¡Œé¢ç«¯æµ‹è¯• (Desktop, window > 768px):</strong></p>
      <ul>
        <li>æ‰¾åˆ°å¸¦æœ‰ <code>â†© å›å¤ [åå­—]</code> çš„å†…è”å¼•ç”¨</li>
        <li>é¼ æ ‡æ‚¬åœåº”æ˜¾ç¤ºç™½è‰²å·¥å…·æç¤ºï¼ŒåŒ…å«å¼•æ–‡å†…å®¹</li>
        <li>ç‚¹å‡»å¼•ç”¨åº”æ»šåŠ¨åˆ°åŸå§‹æ¶ˆæ¯</li>
      </ul>

      <p><strong>ç§»åŠ¨ç«¯æµ‹è¯• (Mobile, window < 768px or DevTools mobile mode):</strong></p>
      <ul>
        <li>ç‚¹å‡» <code>â†© å›å¤ [åå­—]</code> å¼•ç”¨</li>
        <li>åº”æ‰“å¼€å…¨å±æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºå¼•æ–‡å†…å®¹</li>
        <li>ç‚¹å‡» âœ• æˆ–èƒŒæ™¯æˆ–æŒ‰ ESC é”®å…³é—­æ¨¡æ€æ¡†</li>
      </ul>

      <p><strong>è¯­è¨€åˆ‡æ¢:</strong> <button id="lang-toggle">Switch to English</button></p>
    </div>

    <!-- Dialogue Player Container -->
    <div id="dialogue-container"></div>
  </div>

  <!-- Load Dependencies -->
  <script>
    // Mock VULCA_DATA with personas
    window.VULCA_DATA = {
      personas: [
        {
          id: "su-shi",
          nameZh: "è‹è½¼",
          nameEn: "Su Shi",
          color: "#B85C3C"
        },
        {
          id: "guo-xi",
          nameZh: "éƒ­ç†™",
          nameEn: "Guo Xi",
          color: "#2D5F4F"
        },
        {
          id: "john-ruskin",
          nameZh: "çº¦ç¿°Â·ç½—æ–¯é‡‘",
          nameEn: "John Ruskin",
          color: "#6B4C8A"
        }
      ]
    };

    // Mock INTERACTION_TYPES
    window.INTERACTION_TYPES = {
      'initial': { labelZh: 'é¦–å‘', labelEn: 'INITIAL' },
      'agree-extend': { labelZh: 'èµåŒå¹¶å»¶ä¼¸', labelEn: 'AGREE & EXTEND' },
      'question-challenge': { labelZh: 'è´¨ç–‘', labelEn: 'QUESTION' },
      'synthesize': { labelZh: 'ç»¼åˆ', labelEn: 'SYNTHESIZE' }
    };
  </script>
  <script src="js/components/dialogue-player.js"></script>
  <script>
    // Test dialogue thread with quotes
    const testThread = {
      id: "test-thread-1",
      artworkId: "artwork-1",
      topic: "æœºæ¢°ç¬”è§¦ä¸­çš„è‡ªç„¶éŸµå¾‹",
      topicEn: "Natural Rhythm in Mechanical Brushstrokes",
      participants: ["su-shi", "guo-xi", "john-ruskin"],
      messages: [
        {
          id: "msg-1",
          personaId: "su-shi",
          textZh: "è§‚æ­¤ä½œï¼Œæœºæ¢°ä¸è‡ªç„¶äº¤ç»‡ï¼Œæ°ä¼¼ä¹¦æ³•ä¸­çš„æ”¶æ”¾è‡ªå¦‚ã€‚ç¨‹åºæ§åˆ¶å´è•´å«å¤©ç„¶ä¹‹æ°”ï¼Œè¿™æ­£æ˜¯æŠ€è¿›ä¹é“çš„ä½“ç°ã€‚",
          textEn: "Observing this work, the interweaving of mechanical and natural elements resembles the controlled freedom in calligraphy. Though governed by algorithms, it emanates a natural essenceâ€”this is the embodiment of technique approaching the Tao.",
          timestamp: 0,
          replyTo: null,
          interactionType: "initial"
        },
        {
          id: "msg-2",
          personaId: "guo-xi",
          textZh: "æ­£å¦‚ä¸œå¡å…ˆç”Ÿæ‰€è¨€ï¼Œæ­¤ä½œè™½ç”±ç®—æ³•ç”Ÿæˆï¼Œå´æœ‰å±±æ°´ç”»ä¸­ã€ŒçƒŸäº‘ä¾›å…»ã€ä¹‹æ„å¢ƒã€‚æœºæ¢°çš„ç¬”è§¦åè€Œæ›´èƒ½æ•æ‰è‡ªç„¶çš„éšæœºæ€§ä¸ä¸å¯é¢„æµ‹æ€§ã€‚",
          textEn: "As Scholar Su rightly notes, though generated by algorithms, this work embodies the 'nourishment by mist and clouds' found in landscape painting. The mechanical brushstrokes paradoxically better capture nature's randomness and unpredictability.",
          timestamp: 3000,
          replyTo: "su-shi",
          interactionType: "agree-extend",
          quotedText: "ç¨‹åºæ§åˆ¶å´è•´å«å¤©ç„¶ä¹‹æ°”"
        },
        {
          id: "msg-3",
          personaId: "john-ruskin",
          textZh: "æˆ‘å¿…é¡»è´¨ç–‘è¿™ä¸€è§‚ç‚¹ã€‚çœŸæ­£çš„è‰ºæœ¯æºäºäººç±»çš„æƒ…æ„Ÿä¸é“å¾·åˆ¤æ–­ã€‚æœºå™¨å¯ä»¥æ¨¡ä»¿å½¢å¼ï¼Œä½†æ— æ³•ç†è§£è‡ªç„¶èƒŒåçš„ç¥åœ£ç§©åºã€‚",
          textEn: "I must challenge this view. True art originates from human emotion and moral judgment. Machines may imitate form, but cannot comprehend the divine order behind nature.",
          timestamp: 6000,
          replyTo: "guo-xi",
          interactionType: "question-challenge",
          quotedText: "æœºæ¢°çš„ç¬”è§¦åè€Œæ›´èƒ½æ•æ‰è‡ªç„¶çš„éšæœºæ€§"
        },
        {
          id: "msg-4",
          personaId: "su-shi",
          textZh: "ç½—æ–¯é‡‘å…ˆç”Ÿæ‰€è¨€æœ‰ç†ï¼Œä½†æˆ–è®¸æˆ‘ä»¬ä¸åº”å°†äººä¸æœºæ¢°å¯¹ç«‹ã€‚å·¥å…·æœ¬èº«æ— å–„æ¶ï¼Œå…³é”®åœ¨äºä½¿ç”¨è€…çš„å¿ƒæ„ã€‚æ­£å¦‚æ¯›ç¬”ä¹‹äºä¹¦æ³•ï¼Œç®—æ³•ä¹‹äºæ­¤ä½œï¼Œéƒ½æ˜¯ã€Œå™¨ã€ã€‚",
          textEn: "Mr. Ruskin makes a valid point, yet perhaps we should not position humans and machines in opposition. Tools themselves are neither good nor evilâ€”what matters is the user's intention. Just as the brush is to calligraphy, the algorithm is to this workâ€”both are mere instruments.",
          timestamp: 9000,
          replyTo: "john-ruskin",
          interactionType: "synthesize",
          quotedText: "æœºå™¨å¯ä»¥æ¨¡ä»¿å½¢å¼ï¼Œä½†æ— æ³•ç†è§£è‡ªç„¶èƒŒåçš„ç¥åœ£ç§©åº"
        }
      ]
    };

    // Initialize DialoguePlayer
    const container = document.getElementById('dialogue-container');
    const player = new DialoguePlayer(testThread, container, {
      autoPlay: true,
      lang: 'zh'
    });

    console.log('[Test] DialoguePlayer initialized with quote interactions');

    // Language toggle
    const langToggle = document.getElementById('lang-toggle');
    langToggle.addEventListener('click', function() {
      const currentLang = document.documentElement.getAttribute('data-lang');
      const newLang = currentLang === 'zh' ? 'en' : 'zh';
      document.documentElement.setAttribute('data-lang', newLang);
      this.textContent = newLang === 'zh' ? 'Switch to English' : 'åˆ‡æ¢åˆ°ä¸­æ–‡';

      // Trigger langchange event
      window.dispatchEvent(new Event('langchange'));

      console.log('[Test] Language switched to:', newLang);
    });
  </script>
</body>
</html>
