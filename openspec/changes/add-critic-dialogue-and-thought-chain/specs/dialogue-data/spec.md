# Spec: Dialogue Data Structure and Content

**Capability**: `dialogue-data`
**Change**: `add-critic-dialogue-and-thought-chain`
**Version**: 1.0.0

---

## ADDED Requirements

### Requirement: Dialogue Thread Data Schema

The system SHALL define a structured data schema for dialogue threads with type-safe message sequences.

**Acceptance Criteria**:
- [ ] Data file exists at `js/data/dialogues.js`
- [ ] Exports `DIALOGUE_THREADS` array
- [ ] Each thread has: `id`, `artworkId`, `topic`, `topicEn`, `participants`, `messages`
- [ ] Each message has: `id`, `personaId`, `textZh`, `textEn`, `timestamp`, `replyTo`, `interactionType`
- [ ] Total: 20-24 dialogue threads (4 artworks × 5-6 threads each)
- [ ] Optional fields: `quotedText`, `tags`

#### Scenario: Data Schema Validation

**Given** the dialogue data file is loaded
**When** validating the data structure
**Then** all required fields SHALL be present for each thread
**And** all required fields SHALL be present for each message
**And** `timestamp` values SHALL be in ascending order within each thread
**And** `replyTo` SHALL reference valid persona IDs (if not null)
**And** `interactionType` SHALL be one of 6 valid types

**Validation**:
```javascript
import { DIALOGUE_THREADS } from './data/dialogues.js';

const validInteractionTypes = [
  'initial', 'agree-extend', 'question-challenge',
  'synthesize', 'counter', 'reflect'
];

DIALOGUE_THREADS.forEach(thread => {
  console.assert(thread.id, 'Thread must have id');
  console.assert(thread.artworkId, 'Thread must have artworkId');
  console.assert(Array.isArray(thread.messages), 'Thread must have messages array');

  let prevTimestamp = -1;
  thread.messages.forEach(msg => {
    console.assert(msg.timestamp >= prevTimestamp, 'Timestamps must be ascending');
    console.assert(validInteractionTypes.includes(msg.interactionType), 'Invalid interaction type');
    prevTimestamp = msg.timestamp;
  });
});
```

---

### Requirement: Dialogue Content Generation

All dialogue content SHALL be pre-generated by Claude Code with persona-consistent voices and natural conversation flow.

**Acceptance Criteria**:
- [ ] 20-24 total dialogue threads across 4 artworks
- [ ] Each thread: 3-8 messages, 200-800 words total
- [ ] All 6 personas appear across threads (balanced distribution)
- [ ] Bilingual content (Chinese + English) with equal quality
- [ ] Each persona maintains consistent voice with existing critiques
- [ ] Conversations reference specific artwork visual elements
- [ ] Natural reply flow (not parallel monologues)

#### Scenario: Persona Voice Consistency

**Given** existing critique from Su Shi with known RPAIT profile
**When** Su Shi participates in dialogue thread
**Then** Su Shi's dialogue messages SHALL maintain same philosophical tone
**And** semantic similarity to existing critique SHALL be ≥0.80
**And** vocabulary and phrasing SHALL match Su Shi's historical style
**And** RPAIT dimensions SHALL align with Su Shi's profile (P:9, A:8)

**Validation**:
```javascript
// Use semantic analyzer to compare dialogue message to existing critique
const suShiCritique = VULCA_DATA.critiques.find(c => c.personaId === 'su-shi' && c.artworkId === 'artwork-1');
const suShiDialogue = DIALOGUE_THREADS[0].messages.find(m => m.personaId === 'su-shi');

const similarity = await semanticAnalyzer.computeSimilarity(
  suShiCritique.textZh,
  suShiDialogue.textZh
);

console.assert(similarity >= 0.80, `Su Shi voice consistency too low: ${similarity}`);
```

---

### Requirement: Dialogue Thread Topics

Each artwork SHALL have 5-6 dialogue threads organized by distinct discussion topics.

**Acceptance Criteria**:
- [ ] Topics cover: technique, philosophy, cultural context, contemporary relevance
- [ ] Topic titles are bilingual (Chinese + English)
- [ ] Each topic has 3-6 participants
- [ ] No duplicate topics within same artwork
- [ ] Topics reflect natural critical discourse flow

#### Scenario: Topic Diversity

**Given** artwork-1 has 6 dialogue threads
**When** examining thread topics
**Then** topics SHALL cover at least 4 different thematic areas
**And** topics SHALL not overlap significantly (e.g., not 3 threads about same aspect)
**And** each topic SHALL have a clear bilingual title

**Example Topics for Artwork-1 (Memory/机械臂)**:
```javascript
[
  { topic: "笔法与机械运动 / Brushwork and Mechanical Movement" },
  { topic: "心性与程序性 / Spirit vs. Programmatic Nature" },
  { topic: "人机协作的未来 / Future of Human-Machine Collaboration" },
  { topic: "传统与技术的对话 / Dialogue Between Tradition and Technology" },
  { topic: "美学自主性问题 / Question of Aesthetic Autonomy" },
  { topic: "文化传承的新形式 / New Forms of Cultural Transmission" }
]
```

---

### Requirement: Interaction Type Distribution

Dialogue threads SHALL include diverse interaction types representing real critical discourse.

**Acceptance Criteria**:
- [ ] Every thread has at least 1 `initial` message
- [ ] At least 40% of messages are `agree-extend` or `synthesize` (collaborative)
- [ ] At least 20% of messages are `question-challenge` or `counter` (critical)
- [ ] At least 10% of messages are `reflect` (introspective)
- [ ] No thread consists entirely of one interaction type

#### Scenario: Balanced Interaction Distribution

**Given** all 24 dialogue threads
**When** analyzing interaction type distribution
**Then** `agree-extend` SHALL be most common (30-40% of messages)
**And** `question-challenge` SHALL be second most common (20-25% of messages)
**And** `initial` SHALL appear exactly once per thread (start of thread)
**And** `synthesize` SHALL appear in ≥50% of threads (bringing perspectives together)
**And** no single interaction type SHALL dominate (>50% of messages)

**Validation**:
```javascript
const allMessages = DIALOGUE_THREADS.flatMap(t => t.messages);
const typeCounts = {};

allMessages.forEach(msg => {
  typeCounts[msg.interactionType] = (typeCounts[msg.interactionType] || 0) + 1;
});

const totalMessages = allMessages.length;
const agreeExtendPercent = (typeCounts['agree-extend'] / totalMessages) * 100;

console.assert(agreeExtendPercent >= 30 && agreeExtendPercent <= 40,
  `agree-extend should be 30-40%, got ${agreeExtendPercent}%`);
```

---

## MODIFIED Requirements

_None_ - This is an additive feature.

---

## REMOVED Requirements

_None_ - This is an additive feature.

---

## Cross-Capability Dependencies

### Used By:
- `dialogue-playback` - Consumes dialogue data for rendering
- `thought-chain-visualization` - Uses interaction types and reply relationships

---

## Data Quality Metrics

| Metric | Target | Validation Method |
|--------|--------|-------------------|
| Persona voice consistency | ≥0.80 similarity | Semantic embedding comparison |
| Bilingual quality | Equal word count ±20% | Character/word count ratio |
| Topic diversity | ≥4 themes per artwork | Manual topic classification |
| Conversation flow | ≥90% messages reference context | Reply-to graph connectivity |
| Interaction balance | No type >50% | Statistical distribution |

---

## Content Guidelines

**Dialogue Message Writing Rules**:
1. **Persona Consistency**: Match existing critique style and RPAIT profile
2. **Contextual References**: Quote or reference specific artwork elements
3. **Bilingual Parity**: Chinese and English should be equivalently detailed
4. **Natural Flow**: Each message should build on previous messages
5. **Respectful Disagreement**: Challenges should be constructive, not dismissive
6. **Cultural Authenticity**: Maintain each persona's cultural perspective

**Example High-Quality Message**:
```javascript
{
  id: "msg-1-1-2",
  personaId: "guo-xi",
  textZh: "苏兄所言极是。观此画笔法，虽出自机械之手，却有'三远'之意。我注意到远景处笔触渐淡，近景则笔势劲健，颇得山水画'远淡近浓'之法。然机器能悟此理，或是程序设定使然？",
  textEn: "Brother Su speaks truly. Observing this painting's brushwork, though from a mechanical hand, it embodies the 'three distances' principle. I notice the distant strokes fade gradually, while the foreground brushwork is vigorous and strong, achieving the landscape painting method of 'far fades, near deepens.' But can the machine truly comprehend this principle, or is it merely programmatic design?",
  timestamp: 5000,
  replyTo: "su-shi",
  interactionType: "agree-extend",
  quotedText: "笔墨间的自由精神",
  tags: ["technique", "landscape-theory", "philosophy"]
}
```

---

## Validation Checklist

### Data Structure:
- [ ] All threads have valid artwork IDs
- [ ] All messages have ascending timestamps
- [ ] All `replyTo` fields reference valid personas
- [ ] All interaction types are from valid set
- [ ] Bilingual content present for all fields

### Content Quality:
- [ ] Persona voices match existing critiques
- [ ] Conversations flow naturally (not disjointed)
- [ ] Topics are diverse and non-overlapping
- [ ] Specific artwork references included
- [ ] Interaction types match message content

### Quantitative Metrics:
- [ ] 20-24 total threads
- [ ] 3-8 messages per thread
- [ ] 200-800 words per thread
- [ ] All 6 personas represented
- [ ] Balanced interaction type distribution
