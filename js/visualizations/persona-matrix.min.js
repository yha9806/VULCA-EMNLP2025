!function(){"use strict";let e=null,t="all",n="artwork-1",o=["su-shi","guo-xi","john-ruskin"];const a={dimensions:{R:{zh:"代表性",en:"Representation"},P:{zh:"哲学性",en:"Philosophicality"},A:{zh:"美学性",en:"Aesthetics"},I:{zh:"身份性",en:"Identity"},T:{zh:"传统性",en:"Tradition"},all:{zh:"所有RPAIT维度",en:"All RPAIT Dimensions"}},ariaPrefix:{zh:"评论家对比矩阵显示所有评论家的",en:"Critic comparison matrix showing all critics' "}};function i(){return document.documentElement.getAttribute("data-lang")||"zh"}function r(){const e=i(),n=window.VULCA_DATA.personas.filter(e=>o.includes(e.id)),r=n.map(t=>function(e,t){return"en"===t&&e.nameEn||e.nameZh}(t,e));return"all"===t?{labels:r,datasets:[{label:a.dimensions.R[e],data:n.map(e=>d(e.id,"R")),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--rpait-r").trim()},{label:a.dimensions.P[e],data:n.map(e=>d(e.id,"P")),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--rpait-p").trim()},{label:a.dimensions.A[e],data:n.map(e=>d(e.id,"A")),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--rpait-a").trim()},{label:a.dimensions.I[e],data:n.map(e=>d(e.id,"I")),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--rpait-i").trim()},{label:a.dimensions.T[e],data:n.map(e=>d(e.id,"T")),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--rpait-t").trim()}]}:{labels:r,datasets:[{label:a.dimensions[t][e],data:n.map(e=>d(e.id,t)),backgroundColor:getComputedStyle(document.documentElement).getPropertyValue(`--rpait-${t.toLowerCase()}`).trim()}]}}function d(e,t){const o=window.VULCA_ANALYSIS.getPersonaArtworkRPAIT(e,n)||window.VULCA_ANALYSIS.getPersonaAverageRPAIT(e);return o?o[t]:0}function s(){if(!e)return;const n=r();e.data=n,e.update("none"),function(){const e=document.getElementById("persona-matrix-chart");if(!e)return;const n=i(),o=a.dimensions[t][n],r=`${a.ariaPrefix[n]}${o}`;e.setAttribute("aria-label",r)}()}function l(e){const{artworkId:t}=e.detail;t&&(n=t,s())}function c(){window.VULCA_DATA&&window.VULCA_ANALYSIS?window.Chart?(function(){const t=document.getElementById("persona-matrix-chart");if(!t)return void console.error("❌ Matrix chart canvas not found");const n=t.getContext("2d"),a=r();e=new Chart(n,{type:"bar",data:a,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!0,aspectRatio:1.5,scales:{x:{min:0,max:10,ticks:{stepSize:2,font:{size:12}},grid:{color:"rgba(0, 0, 0, 0.1)"}},y:{ticks:{font:{size:12},color:e=>{const t=o[e.index],n=window.VULCA_DATA.personas.find(e=>e.id===t);return n?n.color:"#2d2d2d"}},grid:{display:!1}}},plugins:{legend:{position:"bottom",labels:{font:{size:12},usePointStyle:!0,padding:10}},tooltip:{callbacks:{label:function(e){return`${e.dataset.label}: ${e.parsed.x}/10`}}}},animation:{duration:200}}}),console.log("✓ Persona matrix chart initialized")}(),function(){const e=document.getElementById("dimension-selector");e&&e.addEventListener("change",e=>{var n;n=e.target.value,t=n,s()}),window.addEventListener("visualization:update",l),window.addEventListener("persona:selectionChanged",e=>{const{personas:t}=e.detail;console.log(`[Matrix Chart] Selection changed to ${t.length} personas`,t),o=t,s()}),document.addEventListener("langchange",e=>{console.log("[Matrix Chart] Language changed, updating labels..."),s()}),console.log("✓ Matrix chart event listeners initialized")}()):console.error("❌ Chart.js not loaded"):console.error("❌ VULCA_DATA or VULCA_ANALYSIS not loaded")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),document.addEventListener("vulca-critiques-ready",()=>{console.log("[PersonaMatrix] Critiques ready, re-initializing..."),c()}),window.PersonaMatrix={update:s}}();