!function(){"use strict";window.UnifiedNavigation=class{constructor(e={}){if(!(e.container&&e.container instanceof HTMLElement))throw new Error("[UnifiedNavigation] Container must be a valid DOM element");if(!e.artworkCarousel)throw new Error("[UnifiedNavigation] artworkCarousel is required");this.container=e.container,this.artworkCarousel=e.artworkCarousel,this.showImageNav=!1!==e.showImageNav,this.config={loop:e.config?.loop||!1,autoHide:e.config?.autoHide||!1,transitionDuration:e.config?.transitionDuration||300,theme:e.config?.theme||"default",enableKeyboardShortcuts:!1!==e.config?.enableKeyboardShortcuts,enableTouchGestures:e.config?.enableTouchGestures||!1,showArtworkDots:e.config?.showArtworkDots||!1,...e.config},this.state={currentArtworkIndex:this.artworkCarousel.getCurrentIndex(),currentImageIndex:0,isTransitioning:!1,isRendered:!1},this.elements={wrapper:null,outerNav:null,prevButton:null,nextButton:null,indicator:null,innerContainer:null,imageCarousel:null},this._listeners={click:[],keyboard:[],custom:[]},this._eventHandlers={},this._boundHandlers={prevClick:this._handlePrevClick.bind(this),nextClick:this._handleNextClick.bind(this),keydown:this._handleKeyDown.bind(this),artworkChange:this._handleArtworkChange.bind(this)},console.log(`[UnifiedNavigation] Initialized for ${this.artworkCarousel.getArtworkCount()} artworks`),this.render()}render(){console.log("[UnifiedNavigation] Rendering component..."),this.container.innerHTML="",this.container.className="unified-navigation-wrapper",this.state.isRendered=!0,this._renderOuterLayer(),this._renderInnerLayer(),this._attachEventListeners(),this._syncState(),this._updateButtonStates(),console.log("[UnifiedNavigation] Render complete")}destroy(){console.log("[UnifiedNavigation] Destroying component..."),this._detachEventListeners(),this.elements.imageCarousel&&"function"==typeof this.elements.imageCarousel.destroy&&this.elements.imageCarousel.destroy(),this.container.innerHTML="",this.container.className="",this.elements={},this._listeners={click:[],keyboard:[],custom:[]},this._eventHandlers={},this.state.isRendered=!1,console.log("[UnifiedNavigation] Component destroyed")}updateArtwork(e){console.log(`[UnifiedNavigation] Updating to artwork ${e}`);const t=this.state.currentArtworkIndex;this.state.currentArtworkIndex=e,this._updateIndicator(),this._updateButtonStates(),this._renderInnerLayer(),this._emit("artwork:change",{previousIndex:t,currentIndex:e,artwork:this.artworkCarousel.getCurrentArtwork()})}updateImage(e){console.log(`[UnifiedNavigation] Updating to image ${e}`);const t=this.state.currentImageIndex;this.state.currentImageIndex=e,this._emit("image:change",{previousIndex:t,currentIndex:e})}on(e,t){this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t),console.log(`[UnifiedNavigation] Registered listener for '${e}'`)}off(e,t){this._eventHandlers[e]&&(this._eventHandlers[e]=this._eventHandlers[e].filter(e=>e!==t),console.log(`[UnifiedNavigation] Removed listener for '${e}'`))}_renderOuterLayer(){console.log("[UnifiedNavigation] Rendering outer layer (artwork navigation)..."),this._getCurrentArtwork();const e=this._getArtworkCount(),t=this.state.currentArtworkIndex,n=t>0?this.artworkCarousel.artworks[t-1]:null,i=t<e-1?this.artworkCarousel.artworks[t+1]:null,o=document.createElement("nav");o.className="artwork-navigation",o.setAttribute("role","navigation"),o.setAttribute("aria-label","Artwork navigation");const r=document.createElement("button");r.id="unified-artwork-prev",r.className="artwork-nav-button",r.type="button",r.setAttribute("aria-controls","artwork-image-container"),n?r.setAttribute("aria-label",`Previous artwork: ${n.titleZh} ${n.titleEn}`):(r.setAttribute("aria-label","Previous artwork"),r.disabled=!this.config.loop),r.innerHTML='\n        <span class="button-icon" aria-hidden="true">◄</span>\n        <span class="button-text">Previous Artwork</span>\n      ';const a=document.createElement("div");a.className="artwork-indicator",a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),a.innerHTML=`\n        <span class="current-index" aria-current="page">${t+1}</span>\n        <span class="separator"> of </span>\n        <span class="total-count">${e}</span>\n      `;const s=document.createElement("button");s.id="unified-artwork-next",s.className="artwork-nav-button",s.type="button",i?s.setAttribute("aria-label",`Next artwork: ${i.titleZh} ${i.titleEn}`):(s.setAttribute("aria-label","Next artwork"),s.disabled=!this.config.loop),s.innerHTML='\n        <span class="button-text">Next Artwork</span>\n        <span class="button-icon" aria-hidden="true">►</span>\n      ',o.appendChild(r),o.appendChild(a),o.appendChild(s),this.container.appendChild(o),this.elements.outerNav=o,this.elements.prevButton=r,this.elements.nextButton=s,this.elements.indicator=a,console.log("[UnifiedNavigation] ✓ Outer layer rendered")}_renderInnerLayer(){console.log("[UnifiedNavigation] Rendering inner layer (image container)...");const e=document.createElement("div");e.className="image-display-container",e.id="artwork-image-container";const t=this._getCurrentArtwork();if(!t)return void console.error("[UnifiedNavigation] No current artwork found");const n=window.ImageCompat?window.ImageCompat.getArtworkImages(t):[],i=n.length>1;if(this.showImageNav&&i&&window.ArtworkImageCarousel){console.log(`[UnifiedNavigation] Rendering carousel for ${n.length} images`);const i=new window.ArtworkImageCarousel(t,e,{loop:!0,preloadAdjacent:!0,enableKeyboard:!0,enableTouch:!0,showMetadata:!0,transitionDuration:300});i.render(),this.elements.imageCarousel=i,console.log("[UnifiedNavigation] ✓ Carousel rendered")}else{console.log("[UnifiedNavigation] Rendering single image");const i=document.createElement("figure");i.className="artwork-image";const o=n.length>0?n[0].url:t.imageUrl,r=document.createElement("img");r.src=o,r.alt=`${t.titleZh} ${t.titleEn}`,r.loading="eager",r.onerror=()=>{console.warn(`[UnifiedNavigation] Image not found: ${o}`)},i.appendChild(r),e.appendChild(i),console.log("[UnifiedNavigation] ✓ Single image rendered")}this.container.appendChild(e),this.elements.innerContainer=e,console.log("[UnifiedNavigation] ✓ Inner layer rendered")}_attachEventListeners(){console.log("[UnifiedNavigation] Attaching event listeners..."),this.elements.prevButton&&(this.elements.prevButton.addEventListener("click",this._boundHandlers.prevClick),this._listeners.click.push({element:this.elements.prevButton,event:"click",handler:this._boundHandlers.prevClick}),console.log("[UnifiedNavigation] ✓ Prev button listener attached")),this.elements.nextButton&&(this.elements.nextButton.addEventListener("click",this._boundHandlers.nextClick),this._listeners.click.push({element:this.elements.nextButton,event:"click",handler:this._boundHandlers.nextClick}),console.log("[UnifiedNavigation] ✓ Next button listener attached")),this.artworkCarousel&&"function"==typeof this.artworkCarousel.on&&(this.artworkCarousel.on("navigate",this._boundHandlers.artworkChange),this._listeners.custom.push({source:"artworkCarousel",event:"navigate",handler:this._boundHandlers.artworkChange}),console.log("[UnifiedNavigation] ✓ Carousel navigate listener attached")),this.config.enableKeyboardShortcuts&&(document.addEventListener("keydown",this._boundHandlers.keydown),this._listeners.keyboard.push({element:document,event:"keydown",handler:this._boundHandlers.keydown}),console.log("[UnifiedNavigation] ✓ Keyboard shortcuts enabled (Shift+Arrow)")),console.log("[UnifiedNavigation] ✓ Event listeners attached")}_detachEventListeners(){console.log("[UnifiedNavigation] Detaching event listeners..."),this._listeners.click.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this._listeners.click=[],this._listeners.keyboard.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this._listeners.keyboard=[],this._listeners.custom.forEach(({source:e,event:t,handler:n})=>{"artworkCarousel"===e&&this.artworkCarousel&&"function"==typeof this.artworkCarousel.off&&this.artworkCarousel.off(t,n)}),this._listeners.custom=[],console.log("[UnifiedNavigation] ✓ Event listeners detached")}_syncState(){this.state.currentArtworkIndex=this.artworkCarousel.getCurrentIndex(),console.log(`[UnifiedNavigation] State synced: artwork ${this.state.currentArtworkIndex}`)}_updateIndicator(){if(!this.elements.indicator)return;const e=this.state.currentArtworkIndex,t=this._getArtworkCount();this.elements.indicator.innerHTML=`\n        <span class="current-index" aria-current="page">${e+1}</span>\n        <span class="separator"> of </span>\n        <span class="total-count">${t}</span>\n      `,console.log(`[UnifiedNavigation] Indicator updated: ${e+1} of ${t}`)}_updateButtonStates(){if(!this.elements.prevButton||!this.elements.nextButton)return void console.warn("[UnifiedNavigation] Buttons not found, skipping state update");const e=this.state.currentArtworkIndex,t=this._getArtworkCount(),n=e===t-1;if(0===e)this.elements.prevButton.disabled=!0,this.elements.prevButton.setAttribute("aria-label","No previous artwork available"),console.log("[UnifiedNavigation] Prev button disabled (at first artwork)");else{this.elements.prevButton.disabled=!1;const t=this.artworkCarousel.artworks[e-1],n=`Previous artwork: ${t.titleZh} ${t.titleEn}`;this.elements.prevButton.setAttribute("aria-label",n),console.log("[UnifiedNavigation] Prev button enabled")}if(n)this.elements.nextButton.disabled=!0,this.elements.nextButton.setAttribute("aria-label","No next artwork available"),console.log("[UnifiedNavigation] Next button disabled (at last artwork)");else{this.elements.nextButton.disabled=!1;const t=this.artworkCarousel.artworks[e+1],n=`Next artwork: ${t.titleZh} ${t.titleEn}`;this.elements.nextButton.setAttribute("aria-label",n),console.log("[UnifiedNavigation] Next button enabled")}console.log(`[UnifiedNavigation] Button states updated: artwork ${e+1}/${t}`)}_handlePrevClick(e){if(e.preventDefault(),console.log("[UnifiedNavigation] Prev button clicked"),this.state.isTransitioning)return void console.log("[UnifiedNavigation] Navigation blocked: transition in progress");const t=this.artworkCarousel.prev();t&&console.log(`[UnifiedNavigation] Navigated to previous artwork: ${t.id}`)}_handleNextClick(e){if(e.preventDefault(),console.log("[UnifiedNavigation] Next button clicked"),this.state.isTransitioning)return void console.log("[UnifiedNavigation] Navigation blocked: transition in progress");const t=this.artworkCarousel.next();t&&console.log(`[UnifiedNavigation] Navigated to next artwork: ${t.id}`)}_handleKeyDown(e){if(!this.config.enableKeyboardShortcuts)return;if(!e.shiftKey)return;const t=document.activeElement;if(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)if("ArrowLeft"===e.key){if(e.preventDefault(),console.log("[UnifiedNavigation] Keyboard: Shift+ArrowLeft (prev artwork)"),!this.elements.prevButton||this.elements.prevButton.disabled)return void console.log("[UnifiedNavigation] Prev navigation blocked (at first artwork)");this.artworkCarousel.prev()}else if("ArrowRight"===e.key){if(e.preventDefault(),console.log("[UnifiedNavigation] Keyboard: Shift+ArrowRight (next artwork)"),!this.elements.nextButton||this.elements.nextButton.disabled)return void console.log("[UnifiedNavigation] Next navigation blocked (at last artwork)");this.artworkCarousel.next()}}_handleArtworkChange(e){console.log(`[UnifiedNavigation] Artwork changed to index ${e.index}`);const t=this.state.currentArtworkIndex,n=e.index;this.state.currentArtworkIndex=n,this.state.isTransitioning=!0,this._updateIndicator(),this._updateButtonStates(),this.container.classList.add("transitioning"),setTimeout(()=>{this.elements.innerContainer&&this.elements.innerContainer.remove(),this._renderInnerLayer(),this.container.classList.remove("transitioning"),this.state.isTransitioning=!1,console.log(`[UnifiedNavigation] Transition complete: ${t} → ${n}`)},this.config.transitionDuration||150),this._emit("artwork:change",{previousIndex:t,currentIndex:n,artwork:e.artwork}),console.log(`[UnifiedNavigation] ✓ Artwork change handled: ${e.artwork?.id||"unknown"}`),this._preloadAdjacentArtworks(n)}_preloadAdjacentArtworks(e){const t=this.artworkCarousel?.artworks;t&&t.length&&[e-1,e+1].forEach(e=>{if(e>=0&&e<t.length){const n=t[e],i=n.imageUrl||n.images&&n.images[0]&&n.images[0].url;i&&(window.VULCALazyLoader&&window.VULCALazyLoader.preload?window.VULCALazyLoader.preload(i):(new Image).src=i,console.log(`[UnifiedNavigation] Preloading: ${n.id}`))}})}_emit(e,t){this._eventHandlers[e]&&this._eventHandlers[e].forEach(n=>{try{n(t)}catch(t){console.error(`[UnifiedNavigation] Error in '${e}' handler:`,t)}})}_getArtworkCount(){return this.artworkCarousel.getArtworkCount()}_getCurrentArtwork(){return this.artworkCarousel.getCurrentArtwork()}},console.log("✓ UnifiedNavigation component loaded")}();