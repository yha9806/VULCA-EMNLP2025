function attemptInit(){window.VULCA_DATA_READY?window.GalleryInit.init():document.addEventListener("vulca-data-ready",()=>{window.GalleryInit.init()},{once:!0})}window.GalleryInit=function(){"use strict";function e(e,t){if(!e||!t)return void console.warn("[Gallery Init] Invalid image reference click:",e,t);console.log(`[Gallery Init] Image reference clicked: ${e} for artwork ${t.id}`);const n=(window.ImageCompat?window.ImageCompat.getArtworkImages(t):[]).findIndex(t=>t.id===e);if(-1===n)return void console.warn(`[Gallery Init] Image not found: ${e}`);const a=document.getElementById("artwork-image-container");if(a){const e=new CustomEvent("carousel:navigateTo",{detail:{imageIndex:n},bubbles:!0});a.dispatchEvent(e),console.log(`[Gallery Init] Dispatched navigation event to index ${n}`)}else console.warn(`[Gallery Init] Carousel container not found for artwork ${t.id}`)}return{init:function(){const t=window.VULCA_DATA;if(!(t&&t.artworks&&t.personas&&t.critiques))return void console.error("VULCA_DATA not found or incomplete");const n=document.getElementById("gallery");n?(t.artworks.forEach(t=>{const a=function(t){const n=document.createElement("article");n.className="artwork-section",n.id=t.id,n.setAttribute("data-artwork-id",t.id);const a=function(e){const t=document.createElement("header");t.className="artwork-header";const n=document.createElement("figure");n.className="artwork-image";const a=document.createElement("img");a.src=e.imageUrl,a.alt=`${e.titleZh} ${e.titleEn}`,a.loading="lazy",a.srcset=e.imageUrl,n.appendChild(a),t.appendChild(n);const r=document.createElement("div");r.className="artwork-metadata";const i=document.createElement("h2");i.className="artwork-title";const o=document.createElement("span");o.lang="zh",o.textContent=e.titleZh;const c=document.createElement("span");c.lang="en",c.textContent=e.titleEn,i.appendChild(o),i.appendChild(c),r.appendChild(i);const d=document.createElement("time");return d.className="artwork-year",d.dateTime=e.year,d.textContent=e.year,r.appendChild(d),t.appendChild(r),t}(t);n.appendChild(a);const r=function(t){const n=document.createElement("section");n.className="critiques-container",n.setAttribute("aria-label","Critique perspectives");const a=window.VULCA_DATA;if(!a)return n;const r=a.critiques.filter(e=>e.artworkId===t);return a.personas.forEach(t=>{const a=r.find(e=>e.personaId===t.id);if(a){const r=function(t,n){const a=document.createElement("article");a.className="critique-panel",a.setAttribute("data-persona-id",t.id);const r=document.createElement("header");r.className="critique-header";const i=document.createElement("h3");i.className="persona-name",i.textContent=t.nameZh,r.appendChild(i);const o=document.createElement("span");o.className="persona-era",o.textContent=t.period,r.appendChild(o);const c=document.createElement("span");c.className="persona-color-indicator",c.style.backgroundColor=t.color,r.appendChild(c),a.appendChild(r);const d=document.createElement("div");d.className="critique-body";const l=document.createElement("p");l.className="critique-text",l.lang="zh";const s=document.createElement("p");if(s.className="critique-text",s.lang="en",window.CritiqueParser&&n.artworkId){const t=window.VULCA_DATA?.artworks?.find(e=>e.id===n.artworkId);t?(l.innerHTML=window.CritiqueParser.renderImageReferences(n.textZh,t,{linkClass:"image-reference-link",showImageTitle:!1,format:"chinese"}),s.innerHTML=window.CritiqueParser.renderImageReferences(n.textEn,t,{linkClass:"image-reference-link",showImageTitle:!1,format:"english"}),setTimeout(()=>{l.querySelectorAll(".image-reference-link").forEach(n=>{n.addEventListener("click",a=>{a.preventDefault(),e(n.dataset.imageId,t)})}),s.querySelectorAll(".image-reference-link").forEach(n=>{n.addEventListener("click",a=>{a.preventDefault(),e(n.dataset.imageId,t)})})},0)):(l.textContent=n.textZh,s.textContent=n.textEn)}else l.textContent=n.textZh,s.textContent=n.textEn;d.appendChild(l),d.appendChild(s),a.appendChild(d);const m=document.createElement("footer");m.className="critique-footer";const u=document.createElement("div");u.className="rpait-scores";const p=document.createElement("span");return p.className="rpait-label",p.textContent="RPAIT:",u.appendChild(p),["R","P","A","I","T"].forEach(e=>{const t=document.createElement("span");t.className=`score-${e.toLowerCase()}`,t.textContent=`${e}: ${n.rpait[e]}`,u.appendChild(t)}),m.appendChild(u),a.appendChild(m),a}(t,a);n.appendChild(r)}}),n}(t.id);n.appendChild(r);const i=function(e){const t=document.createElement("section");t.className="visualization-container",t.setAttribute("aria-label","RPAIT visualization");const n=document.createElement("canvas");n.id=`rpait-chart-${e}`,n.setAttribute("role","img"),n.setAttribute("aria-label","RPAIT dimension chart"),t.appendChild(n);const a=document.createElement("div");a.className="visualization-fallback",a.style.display="none";const r=document.createElement("table");return r.innerHTML=`\n      <caption>RPAIT Scores for ${e}</caption>\n      <thead>\n        <tr>\n          <th>Persona</th>\n          <th>R</th>\n          <th>P</th>\n          <th>A</th>\n          <th>I</th>\n          <th>T</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${function(e){const t=window.VULCA_DATA;if(!t)return"";return t.critiques.filter(t=>t.artworkId===e).map(e=>`\n        <tr>\n          <td>${t.personas.find(t=>t.id===e.personaId).nameZh}</td>\n          <td>${e.rpait.R}</td>\n          <td>${e.rpait.P}</td>\n          <td>${e.rpait.A}</td>\n          <td>${e.rpait.I}</td>\n          <td>${e.rpait.T}</td>\n        </tr>\n      `).join("")}(e)}\n      </tbody>\n    `,a.appendChild(r),t.appendChild(a),t}(t.id);return n.appendChild(i),n}(t);n.appendChild(a)}),console.log(`✓ Gallery initialized with ${t.artworks.length} artworks`),console.log(`✓ ${t.critiques.length} critiques loaded`),console.log(`✓ ${t.personas.length} personas available`)):console.error("Gallery element not found")},getArtwork:function(e){return window.VULCA_DATA?.artworks.find(t=>t.id===e)},getPersona:function(e){return window.VULCA_DATA?.personas.find(t=>t.id===e)},getCritiquesForArtwork:function(e){return window.VULCA_DATA?.critiques.filter(t=>t.artworkId===e)},getData:function(){return window.VULCA_DATA}}}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",attemptInit):attemptInit();